<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
        <title>Untitled Document</title>
        <script type="text/javascript" id="jsCookieManagement">
            // Gets the cookie of the passed in name string
            // if the cookie does not exist return null                  
            function GetCookie(c_name)
            {
                if (document.cookie.length > 0) 
                {
                    c_start = document.cookie.indexOf(c_name + "=");
                    if (c_start != -1) 
                    {
                        c_start = c_start + c_name.length + 1;
                        c_end = document.cookie.indexOf(";", c_start);
                        if (c_end == -1) 
                            c_end = document.cookie.length;
                        return unescape(document.cookie.substring(c_start, c_end));
                    }
                }
                return null;
            }
            
            // sets a cookie of the name and value pairs
            // along with the time until it expires                   
            function SetCookie(c_name, value, expiredays)
            {
                var exdate = new Date();
                exdate.setDate(exdate.getDate() + expiredays);
                document.cookie = c_name + "=" + escape(value) + ";expires=" + exdate.toGMTString();
            }
        </script>
        <script id="jsRefreshControl" type="text/javascript">
            var TimeoutPeriod = 0;
            var TimeoutObject = null;
            function ddlRefresh_Changed()
            {
                var ddl = document.getElementById("ddlRefresh");
                TimeoutPeriod = parseInt(ddl.options[ddl.selectedIndex].value);
                SetCookie("CSIPageRefresh", TimeoutPeriod, 10);
                TimedRefresh();
            }
            
            function SetRefresh(RefVal)
            {
                try 
                {
                    TimeoutPeriod = parseInt(RefVal);
                    var ddl = document.getElementById("ddlRefresh");
					ddl.SetItemByValue(TimeoutPeriod);
                    TimedRefresh();
                } 
                catch (e) 
                {
                    alert("An Error has occured " + e.description);
                    
                }
            }
            
            function TimedRefresh(TimeoutPeriod)
            {
                try 
                {
                    if (TimeoutPeriod > 0) 
                    {
                        TimeoutObject = setTimeout("location.reload(true);", TimeoutPeriod * 1000);
                    }
                    else 
                    {
                        if (TimeoutObject != null) 
                            clearTimeout(TimeoutObject);
                    }
                } 
                catch (e) 
                {
                    alert("An Error has occured " + e.description);
                    
                }
            }
            
            Element.prototype.SetItemByValue = function(value)
            {
                if (this.tagName.toLowerCase() != "select") 
                {
                    alert("Incorrect element type: Current Element " + this.id + " is a type of " + this.tagName.toLowerCase() + ". An element type of \"select\" is requred.");
                    return false;
                }
                for (var i = 0; i < this.options.length; i++) 
                {
                    if (this.options[i].value == value) 
                    {
                        this.selectedIndex = i;
                        return true;
                    }
                }
                this.selectedIndex = -1;
                return false;
            }
            
            Element.prototype.SetItemByText = function(value)
            {
                if (this.tagName.toLowerCase() != "select") 
                {
                    alert("Incorrect element type: Current Element " + this.id + " is a type of " + this.tagName.toLowerCase() + ". An element type of \"select\" is requred.");
                    return false;
                }
                for (var i = 0; i < this.options.length; i++) 
                {
                    if (this.options[i].text == value) 
                    {
                        this.selectedIndex = i;
                        return true;
                    }
                }
                this.selectedIndex = -1;
                return false;
                
            }
            /*
            function TestProto()            
            {
            	var ddl  = document.getElementById("ddlRefresh");
				//ddl.SetItemByValue(2);
				ddl.SetItemByText("Reload page every 10 minutes");
            }
            */
        </script>
    </head>
    <body>
        <h1>This is a header</h1>
        <hr/>
        <select id="ddlRefresh" style="width:250;" onchange="javascript:ddlRefresh_Changed(this);">
            <option value="0">Don't reload automatically</option>
            <option value="1" selected>Reload page every minute</option>
            <option value="2">Reload page every 2 minutes</option>
            <option value="5">Reload page every 5 minutes</option>
            <option value="10">Reload page every 10 minutes</option>
            <option value="15">Reload page every 15 minutes</option>
        </select>
        <!-- this is used for testing purposes -->
		<!--
		<hr/>
		<input type="button" id="btnUpdate" onclick="javascript:TestProto();" value="click me"/>
		-->
        <script type="text/javascript" id="jsStartTimer">
            TimeoutPeriod = GetCookie("CSIPageRefresh")
            if (TimeoutPeriod != null) 
            {
                SetRefresh(TimeoutPeriod);
            }
            else 
            {
                SetRefresh(2); // 2 minutes being the default
            }
        </script>
    </body>
</html>
